<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Control Variables and Instrumental Variables</title>
    <meta charset="utf-8" />
    <meta name="author" content="Stijn Masschelein" />
    <script src="slides3_files/header-attrs-2.11/header-attrs.js"></script>
    <script src="slides3_files/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <script src="slides3_files/viz-1.8.2/viz.js"></script>
    <link href="slides3_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="slides3_files/grViz-binding-1.0.8/grViz.js"></script>
    <script src="slides3_files/kePrint-0.0.1/kePrint.js"></script>
    <link href="slides3_files/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Control Variables and Instrumental Variables
### Stijn Masschelein
### March, 2022

---






class:center, middle

# Causal Graphs 

---

## An Example

&lt;center&gt;

<div id="htmlwidget-7aa1f16875ce55bc483e" style="width:720px;height:504px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-7aa1f16875ce55bc483e">{"x":{"diagram":"\ndigraph brand_capital{\ngraph[ rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nBrandCapital; CreditRating\nsubgraph {\nrank = same; InfoEnvironment; FutureCashFlow;\n}\n{BrandCapital} -> {InfoEnvironment, FutureCashFlow};\n{InfoEnvironment, FutureCashFlow} -> CreditRating;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

---

## Slightly more complicated example

&lt;center&gt;

<div id="htmlwidget-3a0853888a4bdf2cad95" style="width:864px;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a0853888a4bdf2cad95">{"x":{"diagram":"\ndigraph brand_capital_complication{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nCumulAds; BrandCapital; CreditRating\nsubgraph {\nrank = same; OtherVars; InfoEnvironment; FutureCashFlow;\n}\nOtherVars -> {CumulAds, CreditRating}\n{CumulAds} -> {BrandCapital}\n{BrandCapital} -> {InfoEnvironment, FutureCashFlow};\n{InfoEnvironment, FutureCashFlow} -> CreditRating;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

---

## Difference with equilibrium models

- All the information that we have is in the causal graph 
- Equilibrium model gives us some insight in the mechanisms and
  underlying conceptual assumptions.
  - E.g. signalling model
  
--

&lt;center&gt;

<div id="htmlwidget-244ebbf2f0303bc076d1" style="width:648px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-244ebbf2f0303bc076d1">{"x":{"diagram":"\ndigraph brand_capital{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nPerformance; Donation; Return;\nPerformance -> Donation;\nDonation -> Return;\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

---

class:center, middle

## Assignment: CSR report

<div id="htmlwidget-bb48d828df67b28f1595" style="width:648px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-bb48d828df67b28f1595">{"x":{"diagram":"\ndigraph measurement_error{\ngraph[layout = dot]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; Performance; CSR_report; Return}\nPerformance -> {CSR_report; Scandals}\nCSR_report -> {Return; Observed_Report}\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---

class:center, middle

# Measurement error and control variables 

---

## Causal Graph 

<div id="htmlwidget-10cbc1b21a5a83f25c07" style="width:648px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-10cbc1b21a5a83f25c07">{"x":{"diagram":"\ndigraph measurement_error{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; CorporateGovernance; TechIndustry}\n{CorporateGovernance, TechIndustry} -> Performance\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

---

## Simulation


```r
set.seed(230383)
N &lt;- 1000
ds &lt;- tibble(CG = runif(N, 0, 10),
             TI = rbinom(N, 1, .25)) %&gt;%
  mutate(Performance = rnorm(N, CG * .15 + TI * 10, 5))
```


```r
lm1 &lt;- lm(Performance ~ CG, data = ds)
lm2 &lt;- lm(Performance ~ CG + TI, data = ds)
```

---

&lt;small&gt;

```r
gof_omit &lt;- "Adj|IC|Log|Pseudo"
stars &lt;- c('\\*' = .1, '\\*\\*' = .05, '\\*\\*\\*' = .01)
msummary(list(lm1, lm2), stars = stars,
         gof_omit = gof_omit, output = "html")
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 2.976\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.036 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.408) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.310) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CG &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.081 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.130\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.073) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.052) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; TI &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 10.433\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.344) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.001 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.480 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.233 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 459.735 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;


???

Measurement error typically decreases the effect and this is also what
happened in the assignment. For instance, the difference between the
donation and no donation should be 3 but it is less. 

---

# Confounders and control variables

---

## Causal Graph 

&lt;center&gt;

<div id="htmlwidget-eac413d9ce79614f5269" style="width:648px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-eac413d9ce79614f5269">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; CorporateGovernance; TechIndustry}\n{CorporateGovernance, TechIndustry} -> Performance\nTechIndustry -> CorporateGovernance\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

---

## Simulation


```r
set.seed(230383)
N &lt;- 1000
ds &lt;- tibble(TI = rbinom(N, 1, .25)) %&gt;%
  mutate(Performance = rnorm(N, TI, 1),
         CG = rnorm(N, .5 - TI, .2))
```



```r
lm1 &lt;- lm(Performance ~ CG, data = ds)
lm2 &lt;- lm(Performance ~ CG + TI, data = ds)
```

---

&lt;small&gt;

```r
msummary(list(lm1, lm2), stars = stars,
         gof_omit = gof_omit, output = "html")
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.461\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.063 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.038) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.092) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CG &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.757\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.198 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.071) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.169) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; TI &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.159\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.187) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.103 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.136 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 114.771 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 78.796 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;

---

## Fixed effects as a special case

&gt; Effects that are the same for an industry, year, firm, individual
&gt; can be adjusted for by using fixed effects.

--

&gt; We do not need to measure the specific variables and can just use
&gt; indicators variables for each category (e.g. for each different
&gt; industry).

---

## [A Gif by Nick Huntington-Klein](https://nickchk.com/causalgraphs.html)

.pull-left[

![Nick C. Huntington-Klein - Fixed Effects](https://nickchk.com/anim/Animation%20of%20Fixed%20Effects.gif)

]

.pull-right[

&lt;center&gt;

<div id="htmlwidget-31413cba4bf454a9170d" style="width:432px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-31413cba4bf454a9170d">{"x":{"diagram":"\ndigraph fixed{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; X; Individual}\n{X, Individual} -> Y \nIndividual -> X\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

]

---

## Speedboat Racing Example ([Booth and Yamamura, 2018](https://doi.org/10.1162/rest_a_00715))

.pull-left[

- Mixed-sex and single-sex races determined by lottery (*Randomisation*)
- 7 race courses
- Multiple races in the same month and location

]

--

.pull-right[

&lt;center&gt;

<div id="htmlwidget-fd9048563928ba8ba951" style="width:504px;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-fd9048563928ba8ba951">{"x":{"diagram":"\n  digraph speedboat{\n  graph[layout = dot]\n  node [shape = box]\n  ave_ability; ltime; mixed_race; female; course;\n  month_location; circumstances;\n  circumstances -> female\n  {mixed_race, female, ave_ability, circumstances} -> ltime\n  female -> {ave_ability}\n  {course month_location} -> circumstances\n  }\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

]

---

## Implementation with `fixest`

```r
library(fixest)
load(here("data", "booth_yamamura.Rdata"))
table &lt;- as_tibble(table) %&gt;%
  select(p_id, women_dat, time, ltime, mix_ra, course,
         race_id, yrmt_locid)
table_clean &lt;- filter(table, complete.cases(table)) %&gt;%
  select(ltime, women_dat, mix_ra, course, p_id, race_id,
         yrmt_locid)
ltime_reg &lt;- feols(ltime ~ women_dat : mix_ra + mix_ra
                   | course + p_id + yrmt_locid,
                   cluster = "race_id",
                   data = table_clean)
```

---

## Results of Boat Races

&lt;small&gt;

```r
msummary(ltime_reg, gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; mix_ra &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.002\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.000) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; women_dat × mix_ra &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.007\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.001) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 142346 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.361 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Within &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.001 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; by: race_id &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FE: course &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FE: p_id &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FE: yrmt_locid &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;

---

class:center, middle

# Colliders 
## Bad Controls, Survival Bias, Selection Bias, Self-Selection Bias 

---

## Causal Diagram

&lt;center&gt;

<div id="htmlwidget-ecd192f44bba719f3ffc" style="width:648px;height:108px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ecd192f44bba719f3ffc">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nCorporateGovernance -> Performance\nPerformance -> StockPrice \n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

--

<div id="htmlwidget-88aeec1d869242e06bd8" style="width:648px;height:108px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-88aeec1d869242e06bd8">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nCorporateGovernance -> Performance\nPerformance -> Survival\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

--

<div id="htmlwidget-05864ce0b11fc332a497" style="width:648px;height:108px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-05864ce0b11fc332a497">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nCorporateGovernance -> Performance\nPerformance -> SP500\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

--

<div id="htmlwidget-60c9d409c338611449f0" style="width:648px;height:108px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-60c9d409c338611449f0">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nCorporateGovernance -> Performance\nPerformance -> IPO\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>

&lt;/center&gt;

---

class: center

## Example in the assignment

<div id="htmlwidget-89ac4de5e66079e7da2d" style="width:504px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-89ac4de5e66079e7da2d">{"x":{"diagram":"\ndigraph measurement_error{\ngraph[layout = dot]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; Performance; CSR_report; Return}\nPerformance -> {CSR_report; Scandals}\nCSR_report -> {Return; Observed_Report}\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
---

## Simulation Bad Control

.center[
<div id="htmlwidget-5b480dd888b9a0d2f8ae" style="width:648px;height:216px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5b480dd888b9a0d2f8ae">{"x":{"diagram":"\ndigraph confounder{\ngraph[layout = dot, rankdir = LR ]\nnode [shape = box, fontname = Helvetica]\nsubgraph{rank = same; CorporateGovernance; Performance}\nCorporateGovernance -> Performance\n{CorporateGovernance, Performance} -> MarketReturn\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
]


```r
d &lt;- tibble(corp_gov = rnorm(N, 0, 1)) %&gt;%
  mutate(acc_profit = rnorm(N, corp_gov, sd = 3),
         market_return = rnorm(N, 2 * corp_gov + acc_profit,
                               sd = 3))
lm1 &lt;- lm(acc_profit ~ corp_gov, data = d)
lm2 &lt;- lm(acc_profit ~ corp_gov + market_return, data = d)
```






---

## Results Bad Control 

&lt;small&gt;

```r
msummary(list(lm1, lm2),
         gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.045 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.023 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.094) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.067) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; corp_gov &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.951\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.512\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.095) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.083) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; market_return &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.486\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.016) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.091 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.536 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 99.708 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 575.320 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;

---

## Simulation Survival Bias


```r
d &lt;- mutate(d, survival = if_else(market_return &gt; 5, 1, 0))
lm1 &lt;- lm(acc_profit ~ corp_gov, data = filter(d, survival == 1))
lm2 &lt;- lm(acc_profit ~ corp_gov * survival, data = d)
```

---

## Results Survival Bias

&lt;small&gt;

```r
msummary(list(lm1, lm2),
         gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 3.512\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.677\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.249) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.094) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; corp_gov &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.174 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.510\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.218) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.099) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; survival &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 4.189\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.301) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; corp_gov × survival &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.684\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.270) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 175 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.004 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.272 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.633 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 124.277 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;

??? 

One interpretation is that a firm can survive by being lucky (and having high returns) and by having good corporate governance (which translates in high returns). The survivors all are more likely to be having good corporate governance and there is little that can be explained further.

---

## Visualisation of colliders 

&lt;img src="slides3_files/figure-html/unnamed-chunk-24-1.svg" style="display: block; margin: auto;" /&gt;



---

class:center, middle

# Instrumental Variable

---

## Causal Diagram


.pull-left[

&lt;center&gt;
<div id="htmlwidget-ce3c76808138796690e9" style="width:648px;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ce3c76808138796690e9">{"x":{"diagram":"\n    digraph randomisation{\n    node [shape = box]\n    subgraph{\n      rank = same; x; y;\n    }\n    confounder; collider;\n    confounder -> {x, y};\n\n    {x, y} -> collider\n    edge [color = blue]\n    x -> y\n    }\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;

]

--

.pull-right[

&lt;center&gt;
<div id="htmlwidget-897c5652dd002c644d51" style="width:648px;height:432px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-897c5652dd002c644d51">{"x":{"diagram":"\n    digraph randomisation{\n    node [shape = box]\n    subgraph{\n      rank = same; x; y; iv;\n    }\n    random; confounder; collider;\n    confounder -> {x, y};\n\n    random -> iv;\n    {x, y} -> collider\n    edge [color = blue]\n    x -> y\n    iv -> x;\n    }\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
&lt;/center&gt;
]

---

## Simulation and Implementation with `fixest`


```r
d &lt;- tibble(
  iv = rnorm(N, 0, 1),
  confounder = rnorm(N, 0, 1)) %&gt;%
  mutate(
    x = rnorm(N, .6 * iv - .6 * confounder, .6),
    y = rnorm(N, .6 * x + .6 * confounder, .6),
    survival = if_else(y &gt; 0, 1, 0)
  )
surv &lt;- filter(d, survival == 1)
lm1 &lt;- lm(y ~ x, d)
lm2 &lt;- lm(y ~ x + confounder, d)
lm3 &lt;- lm(y ~ x, surv)
lm4 &lt;- lm(y ~ x + confounder, surv)
iv1 &lt;- feols(y ~ 1 | 0 | x ~ iv, data = d)
iv2 &lt;- feols(y ~ 1 | 0 | x ~ iv, data = surv)
```

???
All the exogenous variable are in the tibble statement, all the endogenous variables are in the mutate statement. That is not a coincidence. It also highlights the value and tight link between being able to simulate your theory and understanding it.

Note, the collider bias is the biggest problem if the selection bias is on both `x` and `y` because then the collider bias effects the first stage regressions.

---

## Simulation results with a real effect of `x` on `y`

&lt;small&gt;&lt;small&gt;&lt;small&gt;

```r
msummary(list(confounded = lm1, "with control" = lm2, collider = lm3, collider = lm4,
              "iv no collider" = iv1, "iv with collider" = iv2),
         gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; confounded &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; with control &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; collider &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; collider  &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; iv no collider &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; iv with collider &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.030 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.022 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.613\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.488\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.032 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.578\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.024) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.018) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.022) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.025) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.024) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.295\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.625\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.103\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.313\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.023) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.027) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; confounder &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.597\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.299\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.022) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.027) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; fit_x &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.557\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.230\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.042) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.043) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 523 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 523 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 523 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.142 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.505 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.044 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.224 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.029 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.023 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Within &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 165.786 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 507.934 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 24.053 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 75.066 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;&lt;/small&gt;&lt;/small&gt;

---

## Simulation and Implementation with `fixest`


```r
d &lt;- tibble(
  iv = rnorm(N, 0, 1),
  confounder = rnorm(N, 0, 1)) %&gt;%
  mutate(
    x = rnorm(N, .6 * iv - .6 * confounder, .6),
    y = rnorm(N, .6 * confounder, .6),
    survival = if_else(y &gt; 0, 1, 0)
  )
surv &lt;- filter(d, survival == 1)
lm1 &lt;- lm(y ~ x, d)
lm2 &lt;- lm(y ~ x + confounder, d)
lm3 &lt;- lm(y ~ x, surv)
lm4 &lt;- lm(y ~ x + confounder, surv)
iv1 &lt;- feols(y ~ 1 | 0 | x ~ iv, data = d)
iv2 &lt;- feols(y ~ 1 | 0 | x ~ iv, data = surv)
```
---

## Simulation results with no effect

&lt;small&gt;&lt;small&gt;&lt;small&gt;

```r
msummary(list(confounded = lm1, "with control" = lm2, collider = lm3, collider = lm4,
              "iv no collider" = iv1, "iv with collider" = iv2),
         gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; confounded &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; with control &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; collider &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; collider  &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; iv no collider &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; iv with collider &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.005 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.619\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.475\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.662\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.024) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.018) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.022) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.023) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.026) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.025) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; x &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.310\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.013 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.109\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.020 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.023) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.022) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; confounder &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.611\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.322\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.023) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.027) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; fit_x &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.014 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.024 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.044) &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.037) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 508 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 508 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 508 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.150 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.511 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.049 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.263 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.014 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.024 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Within &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; F &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 176.674 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 521.482 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 25.970 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 90.272 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;&lt;/small&gt;&lt;/small&gt;

---

## Example:Sitting Duck Governors [(Falk and Shelton, 2018)](https://pubs.aeaweb.org/doi/pdfplus/10.1257/pol.20160365)


- Research Question: Does political uncertainty effect investment?
- More uncertainty in a state when governor does not come up for
  reelection.
- State level laws with term limits (~ Random)

---

## Data


```r
library(readit)
duck &lt;- readit(here("data", "LameDuckData.dta")) %&gt;%
  select(-starts_with("nstate"), -starts_with("stdum"),
         -starts_with("yd_alt")) %&gt;%
  group_by(statename) %&gt;%
  arrange(year) %&gt;%
  mutate(log_I_1 = lag(log_I), log_I_2 = lag(log_I, 2),
         log_Y_1 = lag(log_Y), log_Y_2 = lag(log_Y, 2),
         log_real_GDP_1 = lag(log_real_GDP),
         log_real_GDP_2 = lag(log_real_GDP, 2)) %&gt;%
  ungroup() %&gt;%
  arrange(statename) %&gt;%
  filter(year &gt;= 1967, year &lt;= 2004)
```

```
## File guessed to be DTA (Stata) (here("data", "LameDuckData.dta"))
```

---

## Reduced Form


```r
form_red &lt;- formula(
  log_I ~ gov_exogenous_middling + log_I_1 + log_I_2 +
  log_Y + log_Y_1 + log_Y_2 + log_real_GDP + log_real_GDP_1 +
  log_real_GDP_2 | statename
  )
red_reg &lt;- feols(form_red, data = duck)
```

```
## NOTE: 250 observations removed because of NA values (RHS: 250).
```

---

## 2 Stage Least Squares (2SLS)


```r
form_iv &lt;- formula(log_I ~ log_I_1 + log_I_2 +
  log_Y + log_Y_1 + log_Y_2 + log_real_GDP + log_real_GDP_1 +
  log_real_GDP_2
  # fixed effects
  | statename
  # 1st regression
  | uncertainty_continuous ~ gov_exogenous_middling
  )
iv_reg &lt;- feols(form_iv, data = duck)
```

```
## NOTE: 250 observations removed because of NA values (RHS: 250).
```

---

## Results

&lt;small&gt;&lt;small&gt;

```r
coef_map = c("gov_exogenous_middling" = "lame duck governor",
             "fit_uncertainty_continuous" = "uncertainty")
msummary(list("reduced" = red_reg,
              "first stage iv" = summary(iv_reg, stage = 1),
              "second stage iv" = iv_reg),
         gof_omit = gof_omit, stars = stars,
         coef_map = coef_map)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; reduced &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; first stage iv &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; second stage iv &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; lame duck governor &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.049\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1.801\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.021) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.112) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; uncertainty &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.027\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.012) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1650 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1650 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1650 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.979 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.194 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.978 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Within &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.846 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.175 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.844 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; by: statename &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; by: statename &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; by: statename &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FE: statename &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; X &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;&lt;/small&gt;

---

## Diagnostics

[Instrumental Variables, Chapter 19, The Effect](https://theeffectbook.net/ch-InstrumentalVariables.html#how-is-it-performed-3)

### Test for endogeneity (Durbin-Wu-Hausmann)

&gt; Is the IV result different from the OLS result?


```r
summ_iv &lt;- summary(iv_reg)
summ_1st &lt;- summary(iv_reg, stage = 1)
summ_iv$iv_wh$stat  # iv wu hausmann
```

```
## [1] 3.829033
```

```r
summ_iv$iv_wh$p     # iv wu hausmann
```

```
## [1] 0.05054677
```

---

### Test for weak instrument

&gt; Is the instrument predicting the variable we want it to predict?

[Instrumental Variables, Chapter 19, The Effect](https://theeffectbook.net/ch-InstrumentalVariables.html#how-is-it-performed-3)


```r
fitstat(iv_reg, type = "ivf")
```

```
## F-test (1st stage), uncertainty_continuous: stat = 331.0, p &lt; 2.2e-16, on 1 and 1,640 DoF.
```

---

# Pitching Template

---

## Pitching Format

1. Description (Important)
    - Title
    - Research Question
    - Key Paper
    - Motivation
2. THREE (IDioT) (Important)
    - Idea 
    - Data 
    - Tools 
3. TWO 
    - What's new?
    - So what?
4. ONE contribution
5. Other considerations.

---

class: middle, center

# Appendix

---

## Why can the `\(R^2\)` be negative with 2SLS?

.pull-left[

```r
iv &lt;- tibble(
  e1 = rnorm(N, 0, 1),
  e2 = rnorm(N, 0, 1),
  z = rnorm(N, 0, 1)) %&gt;%
  mutate(
*   x = .5 * z + e1,
*   y = - 0.4 * x + e1 + e2)
iv2sls &lt;- feols(y ~ 1 | x ~ z, data  = iv)
first_stage &lt;- summary(iv2sls, stage = 1)
```
]

.pull-right[
&lt;small&gt;

```r
msummary(list(first_stage, iv2sls),
         gof_omit = gof_omit, stars = stars)
```

&lt;table style="NAborder-bottom: 0; width: auto !important; margin-left: auto; margin-right: auto;" class="table"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 1 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; Model 2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.021 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.041 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.033) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.042) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; z &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.548\*\*\* &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; (0.033) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; fit_x &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.289\*\*\* &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;box-shadow: 0px 1px"&gt; (0.077) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Num.Obs. &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 1000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 0.220 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; −0.311 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; R2 Within &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
   &lt;td style="text-align:center;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Std.Errors &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; IID &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;tfoot&gt;&lt;tr&gt;&lt;td style="padding: 0; " colspan="100%"&gt;
&lt;sup&gt;&lt;/sup&gt; \* p &amp;lt; 0.1, \*\* p &amp;lt; 0.05, \*\*\* p &amp;lt; 0.01&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;
&lt;/table&gt;
&lt;/small&gt;
]

---

class: center

## Why can the `\(R^2\)` be negative with 2SLS?

![](slides3_files/figure-html/unnamed-chunk-32-1.svg)&lt;!-- --&gt;

---

## Why can the `\(R^2\)` be negative with 2SLS?

- The `\(R^2\)` picks up the correlation between `\(y\)` and `\(x\)`

- We are interested in the causal relation between `\(y\)` and `\(x\)`.

- If the causal relation has the opposite sign as the correlation, `\(R^2\)` will be negative with a correctly specified 2SLS.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"countIncrementalSlides": false,
"highlightLines": true,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
